

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using NumPy and SciPy modules &#8212; Computational Thermodynamics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="First Law of Thermodynamics" href="first-law/first-law.html" />
    <link rel="prev" title="Using CoolProp" href="intro-using-coolprop.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Computational Thermodynamics</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Computational Thermodynamics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="setting-up-environment.html">
   Setting up your computing environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro-solving-problems.html">
   Solving thermodynamics problems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro-using-coolprop.html">
   Using CoolProp
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Using NumPy and SciPy modules
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Modules
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="first-law/first-law.html">
   First Law of Thermodynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="second-law/second-law.html">
   Second Law of Thermodynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exergy/exergy.html">
   Exergy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="properties-pure/properties-pure.html">
   Properties of Pure Fluids
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mixtures/mixtures.html">
   Mixture properties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="combustion/combustion.html">
   Combustion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chemical-equilibrium/chemical-equilibrium.html">
   Chemical Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stat-thermo/stat-thermo.html">
   Statistical Thermodynamics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="zbibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="contributing.html">
   Contributing to this book
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/content/using-scipy.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kyleniemeyer/computational-thermo"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kyleniemeyer/computational-thermo/newbackend?urlpath=tree/book/content/using-scipy.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/kyleniemeyer/computational-thermo/blob/newbackend/book/content/using-scipy.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#index">
   Index
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting">
   Plotting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#solving-systems-of-equations">
   Solving systems of equations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalar-equations">
     Scalar equations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#systems-of-equations-vector-functions">
     Systems of equations / vector functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#integrating-ode-systems">
   Integrating ODE systems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-integral-of-samples">
     Numerical integral of samples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-integral-of-expression">
     Numerical integral of expression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initial-value-problems">
     Initial value problems
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimization">
   Optimization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differentiation">
   Differentiation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-derivatives">
     Numerical derivatives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analytical-derivative">
     Analytical derivative
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="using-numpy-and-scipy-modules">
<h1>Using NumPy and SciPy modules<a class="headerlink" href="#using-numpy-and-scipy-modules" title="Permalink to this headline">¶</a></h1>
<p>In addition to using Cantera and Pint to help solve thermodynamics problems, we will need to use some additional packages in the scientific Python ecosystem to make plots, solve systems of equations, integrate ordinary differential equations, and more.</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>The <a class="reference external" href="https://scipy-lectures.org"><em>SciPy Lecture Notes</em></a> are excellent, detailed resources on all these topics, and Python programming in general <a class="bibtex reference internal" href="zbibliography.html#scipylecture" id="id1">[VGVdeBuyl20]</a>.</p>
</div>
<p>The examples contained in this electronic book will integrate these techniques as needed, but this notebook contains some specific examples.</p>
<div class="section" id="index">
<h2>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#plotting">Plotting</a></p></li>
<li><p><a class="reference external" href="#solving-systems-of-equations">Solving systems of equations</a></p></li>
<li><p><a class="reference external" href="#integrating-ode-systems">Integrating ODE systems</a></p></li>
<li><p><a class="reference external" href="#optimization">Optimization</a></p></li>
<li><p><a class="reference external" href="#differentiation">Differentiation</a></p></li>
</ol>
</div>
<div class="section" id="plotting">
<h2>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline">¶</a></h2>
<p>We can use <a class="reference external" href="https://matplotlib.org">Matplotlib</a> to produce nice plots of our results. If you used Anaconda to set up your computing environment, you likely already have Matplotlib installed; if not, see their <a class="reference external" href="https://matplotlib.org/users/installing.html">installation instructions</a>.</p>
<p>Matplotlib provides an interface that is very similar to what you might already know from Matlab: <code class="docutils literal notranslate"><span class="pre">pyplot</span></code>. You can import this in Python files or a Jupyter notebook with the standard abbreviation <code class="docutils literal notranslate"><span class="pre">plt</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this line makes figures interactive in Jupyter notebooks</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># these lines are only for helping improve the display</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">set_matplotlib_formats</span>
<span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">150</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
</pre></div>
</div>
</div>
</div>
<p>For example, let’s generate some values of an independent variable <span class="math notranslate nohighlight">\(x\)</span> linearly spaced between 0 and 10 (using the NumPy function <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.linspace.html"><code class="docutils literal notranslate"><span class="pre">linspace()</span></code></a>), and then plot the function <span class="math notranslate nohighlight">\(y(x) = \sin(x)\)</span>. We can also add labels to the axes, a legend, and a helpful grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="s1">&#39;y(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/using-scipy_7_0.png" src="../_images/using-scipy_7_0.png" />
</div>
</div>
<p>We can also plot multiple data series in a single figure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sin(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cos(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y axis&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/using-scipy_9_0.png" src="../_images/using-scipy_9_0.png" />
</div>
</div>
<p>Or, we can use subplots to plot multiple axes in the same overall figure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2 rows, 1 column</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sin(x)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;sin(x)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cos(x)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x axis&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;cos(x)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/using-scipy_11_0.png" src="../_images/using-scipy_11_0.png" />
</div>
</div>
</div>
<div class="section" id="solving-systems-of-equations">
<h2>Solving systems of equations<a class="headerlink" href="#solving-systems-of-equations" title="Permalink to this headline">¶</a></h2>
<p>Frequently we will encounter a system of one or more equations that involves an equal number of unknowns. If this is a linear system of equations, we can use linear algebra and the NumPy <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.linalg.solve.html"><code class="docutils literal notranslate"><span class="pre">linalg.solve()</span></code></a> function, but more often in thermodynamics we encounter complex and/or nonlinear systems.</p>
<p>In cases like this, we will need to set up our problems to find the roots, or zeroes, of the function(s); in other words, given a function <span class="math notranslate nohighlight">\(f(x)\)</span>, finding the root means to find the value of <span class="math notranslate nohighlight">\(x\)</span> such that <span class="math notranslate nohighlight">\(f(x) = 0\)</span>. If we are dealing with a system of equations and the same number of unknowns, then these would be vectors: <span class="math notranslate nohighlight">\(\mathbf{f}(\mathbf{x}) = 0\)</span>.</p>
<p>(You might be wondering what to do about equations that don’t equal zero… for example, if you have something like <span class="math notranslate nohighlight">\(f(x) = g(x)\)</span>. In this case, you just need to manipulate the equation to be in the form <span class="math notranslate nohighlight">\(f(x) - g(x) = 0\)</span>.)</p>
<p>The <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html">SciPy optimization module</a> provides functions to find roots of equations; for scalar equations, we can use <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.root_scalar.html#scipy.optimize.root_scalar"><code class="docutils literal notranslate"><span class="pre">root_scalar()</span></code></a>, and for vector equations, we can use <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.root.html"><code class="docutils literal notranslate"><span class="pre">root()</span></code></a>.</p>
<div class="section" id="scalar-equations">
<h3>Scalar equations<a class="headerlink" href="#scalar-equations" title="Permalink to this headline">¶</a></h3>
<p>Let’s first look at an example of a scalar function: one equation, one unknown.</p>
<p>Find the root of this equation:
\begin{equation}
\cos(x) = x^3
\end{equation}</p>
<p>We need to create a Python function that returns <span class="math notranslate nohighlight">\(f(x) = 0\)</span>, so that the function returns zero when the input value of <span class="math notranslate nohighlight">\(x\)</span> is the (correct) root. Then, we can use the <code class="docutils literal notranslate"><span class="pre">root_scalar</span></code> function with some initial guesses.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Root: x =</span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">root</span><span class="si">:</span><span class="s1"> .3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Function evaluated at root: </span><span class="si">{</span><span class="n">func</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Root: x = 0.865
Function evaluated at root: 1.1102230246251565e-16
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="systems-of-equations-vector-functions">
<h3>Systems of equations / vector functions<a class="headerlink" href="#systems-of-equations-vector-functions" title="Permalink to this headline">¶</a></h3>
<p>We can also solve systems of equations in a similar fashion using the SciPy <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.root.html"><code class="docutils literal notranslate"><span class="pre">root()</span></code></a> functino, where we find the roots <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> that satisfy <span class="math notranslate nohighlight">\(\mathbf{f} (\mathbf{x}) = 0\)</span>.</p>
<p>For example, let’s try to find the values of <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> that satisfy these equations:
$<span class="math notranslate nohighlight">\(
x \ln (x) = y^3 \\
\sqrt{x} = \frac{1}{y}
\)</span>$</p>
<p>We have two equations and two unknowns, so we should be able to find the roots.</p>
<p>To solve, we create a function that evaluates these equations when made equal to zero, or</p>
<div class="math notranslate nohighlight">
\[\begin{split}
x \ln (x) - y^3 = 0 \\
\sqrt{x} - \frac{1}{y} = 0
\end{split}\]</div>
<p>then we call <code class="docutils literal notranslate"><span class="pre">root</span></code> specifying this function and two initial guesses for <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>

<span class="k">def</span> <span class="nf">system</span><span class="p">(</span><span class="nb">vars</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">y</span><span class="p">)</span>
        <span class="p">]</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Roots: x = </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1"> .3f</span><span class="si">}</span><span class="s1">, y = </span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s1"> .3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Roots: x =  1.467, y =  0.826
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="integrating-ode-systems">
<h2>Integrating ODE systems<a class="headerlink" href="#integrating-ode-systems" title="Permalink to this headline">¶</a></h2>
<p>In some cases, we encounter problems that require integrating one or more ordinary different equations in time. Depending on the form of the problem, we may need to integrate a function between two points (definite integral), or we may have a system of ordinary differential equations.</p>
<div class="section" id="numerical-integral-of-samples">
<h3>Numerical integral of samples<a class="headerlink" href="#numerical-integral-of-samples" title="Permalink to this headline">¶</a></h3>
<p>In some cases we have a set of <span class="math notranslate nohighlight">\((x,y)\)</span> data that we want to integrate numerically.
We can do this using the NumPy <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.trapz.html"><code class="docutils literal notranslate"><span class="pre">trapz()</span></code> function</a>, which implements the composite trapezoidal rule.</p>
<p>For example, let’s consider a situation where a reciprocating compressor is being used to compress ammonia vapor during a refrigeration cycle. We have some experimental measurements of the pressure-volume data during the compression stroke (see table), and we want to determine the work done on the ammonia by the piston.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Pressure (psi)</p></th>
<th class="head"><p>Volume (in^3)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>65.1</p></td>
<td><p>80.0</p></td>
</tr>
<tr class="row-odd"><td><p>80.5</p></td>
<td><p>67.2</p></td>
</tr>
<tr class="row-even"><td><p>93.2</p></td>
<td><p>60.1</p></td>
</tr>
<tr class="row-odd"><td><p>110</p></td>
<td><p>52.5</p></td>
</tr>
<tr class="row-even"><td><p>134</p></td>
<td><p>44.8</p></td>
</tr>
<tr class="row-odd"><td><p>161</p></td>
<td><p>37.6</p></td>
</tr>
<tr class="row-even"><td><p>190</p></td>
<td><p>32.5</p></td>
</tr>
</tbody>
</table>
<p>To find the work done by the piston to the ammonia, we can integrate pressure with respect to volume:
\begin{equation}
W_{\text{in}} = -\int_{V_1}^{V_2} P , dV
\end{equation}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pint</span> <span class="kn">import</span> <span class="n">UnitRegistry</span>
<span class="n">ureg</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>
<span class="n">Q_</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span>

<span class="n">pressure</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">([</span><span class="mf">65.1</span><span class="p">,</span> <span class="mf">80.5</span><span class="p">,</span> <span class="mf">93.2</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">190</span><span class="p">],</span> <span class="s1">&#39;psi&#39;</span><span class="p">)</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">([</span><span class="mf">80.0</span><span class="p">,</span> <span class="mf">67.2</span><span class="p">,</span> <span class="mf">60.1</span><span class="p">,</span> <span class="mf">52.5</span><span class="p">,</span> <span class="mf">44.8</span><span class="p">,</span> <span class="mf">37.6</span><span class="p">,</span> <span class="mf">32.5</span><span class="p">],</span> <span class="s1">&#39;in^3&#39;</span><span class="p">)</span>

<span class="c1"># convert to SI units</span>
<span class="n">pressure</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span>
<span class="n">volume</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="s1">&#39;m^3&#39;</span><span class="p">)</span>

<span class="n">work</span> <span class="o">=</span> <span class="o">-</span><span class="n">Q_</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">pressure</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">volume</span><span class="o">.</span><span class="n">magnitude</span><span class="p">),</span> 
    <span class="n">pressure</span><span class="o">.</span><span class="n">units</span> <span class="o">*</span> <span class="n">volume</span><span class="o">.</span><span class="n">units</span>
    <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Work done on fluid: </span><span class="si">{</span><span class="n">work</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">)</span><span class="si">:</span><span class="s1"> .2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Work done on fluid: 589.45 joule
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="numerical-integral-of-expression">
<h3>Numerical integral of expression<a class="headerlink" href="#numerical-integral-of-expression" title="Permalink to this headline">¶</a></h3>
<p>We can also numerically integrate expressions/functions using the SciPy <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.quad.html"><code class="docutils literal notranslate"><span class="pre">quad()</span></code> function</a>, also in the <code class="docutils literal notranslate"><span class="pre">integrate</span></code> module.</p>
<p>Let’s build on the previous example: first, let’s fit the compressor data to the polytropic form <span class="math notranslate nohighlight">\(P V^n = c\)</span>, where <span class="math notranslate nohighlight">\(c\)</span> and <span class="math notranslate nohighlight">\(n\)</span> are constants, then we can integrate the resulting function to calculate work.</p>
<p>To fit the data, we need to rearrange the equation to the form <span class="math notranslate nohighlight">\(y = f(x)\)</span>:
\begin{equation}
P = c V^{-n}
\end{equation}
We’ll use the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html"><code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit()</span></code></a> function for that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="kn">from</span> <span class="nn">pint</span> <span class="kn">import</span> <span class="n">UnitRegistry</span>
<span class="n">ureg</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>
<span class="n">Q_</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span>

<span class="n">pressure</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">([</span><span class="mf">65.1</span><span class="p">,</span> <span class="mf">80.5</span><span class="p">,</span> <span class="mf">93.2</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">190</span><span class="p">],</span> <span class="s1">&#39;psi&#39;</span><span class="p">)</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">([</span><span class="mf">80.0</span><span class="p">,</span> <span class="mf">67.2</span><span class="p">,</span> <span class="mf">60.1</span><span class="p">,</span> <span class="mf">52.5</span><span class="p">,</span> <span class="mf">44.8</span><span class="p">,</span> <span class="mf">37.6</span><span class="p">,</span> <span class="mf">32.5</span><span class="p">],</span> <span class="s1">&#39;in^3&#39;</span><span class="p">)</span>

<span class="c1"># convert to SI units</span>
<span class="n">pressure</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span>
<span class="n">volume</span><span class="o">.</span><span class="n">ito</span><span class="p">(</span><span class="s1">&#39;m^3&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Evaluate P = c * V**(-n). </span>
<span class="sd">    </span>
<span class="sd">    n and c will be found by the curve_fit functino.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="o">-</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># this function will automatically fit the unknown constants</span>
<span class="n">params</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">volume</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">pressure</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Parameters: n=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1"> 5.3f</span><span class="si">}</span><span class="s1">, c=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1"> 5.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parameters: n= 1.170, c= 194.200
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/share/miniconda/envs/thermo-env/lib/python3.7/site-packages/ipykernel_launcher.py:21: RuntimeWarning: overflow encountered in power
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">volume</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">pressure</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">volume</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># plot data and fit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;fit: n=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1"> 5.3f</span><span class="si">}</span><span class="s1">, c=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1"> 5.3f</span><span class="si">}</span><span class="s1">&#39;</span>
         <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Volume (m^3)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure (Pa)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">scilimits</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/using-scipy_22_0.png" src="../_images/using-scipy_22_0.png" />
</div>
</div>
<p>That looks like a great fit to the data, so now let’s evaluate the work by integrating:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span>
    <span class="n">fit</span><span class="p">,</span> <span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">volume</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> 
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">)</span>

<span class="n">work</span> <span class="o">=</span> <span class="o">-</span><span class="n">Q_</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pressure</span><span class="o">.</span><span class="n">units</span> <span class="o">*</span> <span class="n">volume</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Work done on fluid: </span><span class="si">{</span><span class="n">work</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">)</span><span class="si">:</span><span class="s1"> .2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Work done on fluid: 586.26 joule
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="initial-value-problems">
<h3>Initial value problems<a class="headerlink" href="#initial-value-problems" title="Permalink to this headline">¶</a></h3>
<p>In other words, we may have a system like
\begin{equation}
\frac{d \mathbf{y}}{dt} = \mathbf{f} (t, \mathbf{y})
\end{equation}
where <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> is the vector of state variables, for which we should have the initial values (<span class="math notranslate nohighlight">\(\mathbf{y}(t=0)\)</span>). In this case, we can use the SciPy function <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html"><code class="docutils literal notranslate"><span class="pre">solve_ivp()</span></code> function</a>, part of the <code class="docutils literal notranslate"><span class="pre">integrate</span></code> module.</p>
<p>For example, let’s consider a problem where we want to find the volume of water, volume of air, and pressure in a tank as a function of time, as the tank releases water to an environment. The volumetric flow rate through the tank’s valve is based on its instantaneous pressure:</p>
<div class="math notranslate nohighlight">
\[
\dot{V}_f = \frac{P - P_{\text{atm}}}{R_v} \;,
\]</div>
<p>where <span class="math notranslate nohighlight">\(P_{\text{atm}}\)</span> is atmospheric pressure and <span class="math notranslate nohighlight">\(R_v = 10\)</span> psi/gpm is the valve resistance parameter. The tank has volume 50 gal, and is initially filled with water (volume fraction <span class="math notranslate nohighlight">\(f\)</span> = 0.8); the air in the tank is initially at 100 psi. We will treat the air as an ideal gas, and the water as an incompressible substance.</p>
<p>We have the initial air pressure, and we can calculate the initial volumes of water and air:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
V_{f,0} = f \, V \\
V_{g,0} = (1 - f) V \\
\end{split}\]</div>
<p>We can perform a mass balance on the water in the tank to obtain a rate equation for the volume of water:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
0 = \dot{m}_f + \frac{d m_f}{dt} = \dot{V}_f \rho_f + \rho_f \frac{d V_f}{dt} \\
0 = \dot{V}_f + \frac{dV_f}{dt} \\
\therefore \frac{dV_f}{dt} &amp;= -\frac{(P - P_{\text{atm}})}{R_v}
\end{split}\]</div>
<p>Since the overall volume of the tank is constant, we can obtain the rate of change of the volume of air:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
V = V_g + V_f \\
\frac{dV_g}{dt} + \frac{dV_f}{dt} = 0 \\
\therefore \frac{dV_g}{dt} = -\frac{dV_f}{dt}
\end{split}\]</div>
<p>Finally, a mass balance on the air in the tank allows us to find the rate of change of pressure:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
0 = \frac{dm_a}{dt} \\
0 = \frac{d}{dt} \left( \frac{P V_g}{R T} \right) \\
0 = V_g \frac{dP}{dt} + P \frac{dV_g}{dt} \\
\therefore \frac{dP}{dt} = -\frac{P}{V_g} \frac{dV_g}{dt}
\end{split}\]</div>
<p>Now, we can integrate this system of ODEs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pint</span> <span class="kn">import</span> <span class="n">UnitRegistry</span>
<span class="n">ureg</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>
<span class="n">Q_</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span>

<span class="c1"># initial conditions and constants</span>
<span class="n">valve_resistance</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;psi/(gal/min)&#39;</span><span class="p">)</span>
<span class="n">pressure_atmosphere</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;atm&#39;</span><span class="p">)</span>

<span class="n">volume_tank</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;gal&#39;</span><span class="p">)</span>
<span class="n">water_fraction</span> <span class="o">=</span> <span class="mf">0.8</span>

<span class="n">pressure_initial</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;psi&#39;</span><span class="p">)</span>
<span class="n">volume_water_initial</span> <span class="o">=</span> <span class="n">water_fraction</span> <span class="o">*</span> <span class="n">volume_tank</span>
<span class="n">volume_air_initial</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">water_fraction</span><span class="p">)</span> <span class="o">*</span> <span class="n">volume_tank</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tank_equations</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">valve_resistance</span><span class="p">,</span> <span class="n">pressure_atmosphere</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Rates of change for water volume, air volume, and air pressure in tank.</span>
<span class="sd">    </span>
<span class="sd">    Input values in SI units.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">volume_water</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;m^3&#39;</span><span class="p">)</span>
    <span class="n">volume_air</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;m^3&#39;</span><span class="p">)</span>
    <span class="n">pressure_air</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;Pa&#39;</span><span class="p">)</span>
    
    <span class="n">dVf_dt</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">pressure_air</span> <span class="o">-</span> <span class="n">pressure_atmosphere</span><span class="p">)</span> <span class="o">/</span> <span class="n">valve_resistance</span>
    <span class="n">dVg_dt</span> <span class="o">=</span> <span class="o">-</span><span class="n">dVf_dt</span>
    <span class="n">dP_dt</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">pressure_air</span> <span class="o">/</span> <span class="n">volume_air</span><span class="p">)</span> <span class="o">*</span> <span class="n">dVg_dt</span>
    
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">dVf_dt</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m^3/s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> 
        <span class="n">dVg_dt</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m^3/s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span>
        <span class="n">dP_dt</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;Pa/s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
        <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have the initial conditions and rate function set up, we can integrate in time. Let’s do this for 500 seconds, and then plot the water volume and tank pressure as functions of time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="c1"># now integrate for 500 seconds, specifying the function, time interval, </span>
<span class="c1">#initial conditions, and additional arguments to the function</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">tank_equations</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">500.0</span><span class="p">],</span>
    <span class="p">[</span><span class="n">volume_water_initial</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m^3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> 
     <span class="n">volume_air_initial</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m^3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> 
     <span class="n">pressure_initial</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;Pa&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
     <span class="p">],</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">valve_resistance</span><span class="p">,</span> <span class="n">pressure_atmosphere</span><span class="p">,),</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BDF&#39;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">t</span>
<span class="n">volume_water</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;m^3&#39;</span><span class="p">)</span>
<span class="n">volume_air</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;m^3&#39;</span><span class="p">)</span>
<span class="n">pressure</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;Pa&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">pressure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;psi&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Tank pressure (psi)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">volume_water</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;gal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Water volume (gal)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Water volume (gal) and tank pressure (psi)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="c1"># ensure lower y-axis bound is zero</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/using-scipy_30_0.png" src="../_images/using-scipy_30_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="optimization">
<h2>Optimization<a class="headerlink" href="#optimization" title="Permalink to this headline">¶</a></h2>
<p>For some problems, we may want to find the input parameter(s) that minimize or maximize some function. In these cases, we can use the SciPy <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize_scalar.html"><code class="docutils literal notranslate"><span class="pre">minimize_scalar()</span></code></a> function for a scalar function with one input variable, or the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html"><code class="docutils literal notranslate"><span class="pre">minimize()</span></code></a> function for a scalar function of one or more input variables.</p>
<p>(Note: this is a fairly complicated topic, and we will only consider relatively simple optimization problems.)</p>
<p>For example, consider a spring with a horizontal force applied; we can calculate the potential energy of the spring:
\begin{equation}
PE(x) = 0.5 k x^2 - F x ;.
\end{equation}
At equilibrium, the potential energy will be at a minimum, so given a particular force we can find the displacement by finding the value that minimizes the potential energy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize_scalar</span>

<span class="n">spring_constant</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="c1"># N/cm</span>
<span class="n">force</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="c1"># N</span>

<span class="k">def</span> <span class="nf">spring</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates potential energy of spring pulled by force.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">F</span> <span class="o">*</span> <span class="n">x</span>


<span class="n">sol</span> <span class="o">=</span> <span class="n">minimize_scalar</span><span class="p">(</span><span class="n">spring</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">spring_constant</span><span class="p">,</span> <span class="n">force</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Equilibrium displacement: </span><span class="si">{</span><span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="si">:</span><span class="s1"> .2f</span><span class="si">}</span><span class="s1"> cm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Equilibrium displacement:  2.50 cm
</pre></div>
</div>
</div>
</div>
<p>A more complicated problem is a system with two springs, connected at one end with a force in some general direction (with <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> components); the system has both horizontal and vertical components. The springs have spring constants <span class="math notranslate nohighlight">\(k_a\)</span> and <span class="math notranslate nohighlight">\(k_b\)</span>, and unloaded lengths <span class="math notranslate nohighlight">\(L_a\)</span> and <span class="math notranslate nohighlight">\(L_b\)</span>.</p>
<p>The potential energy for this system is
\begin{equation}
PE(x,y) = 0.5 k_a \left( \sqrt{x^2 + (L_a - y)^2} - L_a \right)^2 + 0.5 k_b \left( \sqrt{x^2 + (L_b + y)^2} - L_b \right)^2 - F_x x - F_y y
\end{equation}
where <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> are the horizontal and vertical deformations from the unloaded state.
We can minimize this function of two variables to find the displacement based on the force:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>

<span class="n">spring_constant_a</span> <span class="o">=</span> <span class="mf">9.0</span> <span class="c1"># N/cm</span>
<span class="n">spring_constant_b</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="c1"># N/cm</span>
<span class="n">length_a</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># cm</span>
<span class="n">length_b</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># cm</span>

<span class="n">force_x</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="c1"># N</span>
<span class="n">force_y</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="c1"># N</span>

<span class="k">def</span> <span class="nf">spring_system</span><span class="p">(</span><span class="n">xvec</span><span class="p">,</span> <span class="n">ka</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">La</span><span class="p">,</span> <span class="n">Lb</span><span class="p">,</span> <span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Calculates potential energy of springs pulled by force.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">xvec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">xvec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="mf">0.5</span><span class="o">*</span><span class="n">ka</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">La</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">La</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
        <span class="mf">0.5</span><span class="o">*</span><span class="n">kb</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Lb</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Lb</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="o">-</span> <span class="p">(</span><span class="n">Fx</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">Fy</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">)</span>

<span class="n">guesses</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
    <span class="n">spring_system</span><span class="p">,</span> <span class="n">guesses</span><span class="p">,</span> 
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">spring_constant_a</span><span class="p">,</span> <span class="n">spring_constant_b</span><span class="p">,</span> 
          <span class="n">length_a</span><span class="p">,</span> <span class="n">length_b</span><span class="p">,</span> <span class="n">force_x</span><span class="p">,</span> <span class="n">force_y</span>
          <span class="p">)</span>
    <span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Equilibrium displacement: x=</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1"> .2f</span><span class="si">}</span><span class="s1"> cm, y=</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s1"> .2f</span><span class="si">}</span><span class="s1"> cm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Equilibrium displacement: x= 4.95 cm, y= 1.28 cm
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="differentiation">
<h2>Differentiation<a class="headerlink" href="#differentiation" title="Permalink to this headline">¶</a></h2>
<p>Many thermodynamic properties are derivatives of other properties, so you may find the need to take derivatives of either data or of an expression. We can use the NumPy function <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.gradient.html"><code class="docutils literal notranslate"><span class="pre">gradient()</span></code></a> to take numerical derivatives of data using finite differences, and we can use <a class="reference external" href="https://www.sympy.org/en/index.html">SymPy</a> to find analytical derivatives of expressions.</p>
<div class="section" id="numerical-derivatives">
<h3>Numerical derivatives<a class="headerlink" href="#numerical-derivatives" title="Permalink to this headline">¶</a></h3>
<p>Let’s say we have data for some function <span class="math notranslate nohighlight">\(f(x) = x^2\)</span> at some locations <span class="math notranslate nohighlight">\(x\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/using-scipy_37_0.png" src="../_images/using-scipy_37_0.png" />
</div>
</div>
<p>We do not need to know the functional form of <span class="math notranslate nohighlight">\(f(x)\)</span> to take the numerical derivatives—this example just uses a simple function for ease of checking the results.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gradient()</span></code> function uses second-order central differences to evaluate the derivative of input data, using forward and backward differences at the boundaries. Let’s use that to get the derivative, and compare against the exact derivative (<span class="math notranslate nohighlight">\(\frac{df}{dx} = 2x\)</span>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">dfdx_exact</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfdx_exact</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfdx</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Numerical&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;df/dx&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/using-scipy_39_0.png" src="../_images/using-scipy_39_0.png" />
</div>
</div>
<p>The numerical derivative we obtain is very accurate, thanks to the linear nature of the derivative. However, at the boundaries the approximate derivative is a bit off, due to the first-order finite differences used there.</p>
</div>
<div class="section" id="analytical-derivative">
<h3>Analytical derivative<a class="headerlink" href="#analytical-derivative" title="Permalink to this headline">¶</a></h3>
<p>In some cases we may be given (or obtain) analytical expressions that we need to differentiate. Given a function, we have two options for calculating the derivative:</p>
<ol class="simple">
<li><p>Use the function to calculate values over the desired range, then numerically differentiate.</p></li>
<li><p>Obtain the exact derivative by differentiating analytically.</p></li>
</ol>
<p>We’ll now focus on the latter case; we can use SymPy to construct a function symbolically, and then find the exact derivative.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sympy</span>
<span class="n">sympy</span><span class="o">.</span><span class="n">init_printing</span><span class="p">(</span><span class="n">use_latex</span><span class="o">=</span><span class="s1">&#39;mathjax&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># take derivative of f with respect to x</span>
<span class="n">dfdx</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="c1"># this complicated expression is only necessary for printing.</span>
<span class="c1"># It creates an equation object, that sets the unevaluated </span>
<span class="c1"># derivative of f equal to the calculated derivative.</span>
<span class="n">display</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Eq</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Derivative</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">dfdx</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\displaystyle \frac{d}{d x} x^{2} = 2 x\]</div>
</div>
</div>
<p>Once we have evaluated the analytical derivative, we can even turn it into a Python function for evaluation! Passing the <code class="docutils literal notranslate"><span class="pre">'numpy'</span></code> argument creates a NumPy array-compatible function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calc_derivative</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfdx</span><span class="p">,</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>

<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact derivative&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">calc_derivative</span><span class="p">(</span><span class="n">x_vals</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SymPy derivative&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;df/dx&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/using-scipy_44_0.png" src="../_images/using-scipy_44_0.png" />
</div>
</div>
<p>As expected, the exact derivative we calculated using SymPy matches the known derivative perfectly—this was obtained symbolically, so there are no approximations/errors involved.</p>
<p>When taking the derivative of more complicated expressions that involve other functions (e.g., <span class="math notranslate nohighlight">\(\sin\)</span>, <span class="math notranslate nohighlight">\(\log\)</span>), you will need to use the SymPy-provided versions: <code class="docutils literal notranslate"><span class="pre">sympy.sin</span></code>, <code class="docutils literal notranslate"><span class="pre">sympy.log</span></code>, etc. We also need to explicitly define symbolic variables, either using <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">sympy.Symbol('x')</span></code> to create one variable at a time or <code class="docutils literal notranslate"><span class="pre">x,</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">sympy.symbols('x</span> <span class="pre">y',</span> <span class="pre">real=True)</span></code> to create multiple variables at once. (The string you specify is the displayed representation of the variable, and can include complex formatting such as subscripts/superscripts and Greek letters.)</p>
<p>For example, let’s take the derivative of
\begin{equation}
f(x) = \log(x) + x^3
\end{equation}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>

<span class="n">dfdx</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">dfdx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\displaystyle 3 x^{2} + \frac{1}{x}\]</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="intro-using-coolprop.html" title="previous page">Using CoolProp</a>
    <a class='right-next' id="next-link" href="first-law/first-law.html" title="next page">First Law of Thermodynamics</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Kyle Niemeyer<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>